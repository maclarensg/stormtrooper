# PRD: Stormtrooper v0.1.0 — MVP

## Overview

Stormtrooper is an open-source AI coding assistant CLI written in Go. It provides a conversational terminal interface that can read/edit files, execute shell commands, search codebases, maintain persistent memory, and coordinate agent teams — all powered by open-source models via OpenRouter.

## Problem

Developers want AI-assisted coding tools that:
- Work with open-source models (not locked to proprietary APIs).
- Run in the terminal as a conversational tool.
- Can actually interact with the codebase (read, edit, search, run commands).
- Remember context across sessions.
- Can parallelize work using agent teams.

## Users

Developers who prefer open-source models and terminal-based workflows.

## Tech Stack

- **Language**: Go
- **LLM Provider**: OpenRouter.ai (API-compatible)
- **Models**: Kimi-K2, MiniMax-M2.1, GLM-4.7
- **Distribution**: `go run .` / `go build` (simple binary)

## Features & Acceptance Criteria

### F1: Conversational REPL

A terminal-based chat interface where the user types messages and gets AI responses.

**Acceptance Criteria:**
- AC1: User launches `stormtrooper` and sees a prompt.
- AC2: User types a message, presses Enter, and sees a streamed AI response.
- AC3: Responses render with markdown formatting (bold, code blocks, etc.).
- AC4: User can exit with `Ctrl+C` or typing `/exit`.
- AC5: Multi-line input is supported (e.g., pasting code).

### F2: OpenRouter Integration

Communicate with LLMs via the OpenRouter API.

**Acceptance Criteria:**
- AC1: API key is read from `OPENROUTER_API_KEY` environment variable.
- AC2: User can select a model via config or CLI flag (`--model`).
- AC3: Supported models: `moonshotai/kimi-k2`, `minimax/minimax-m1`, `zhipu-ai/glm-4-plus` (exact OpenRouter model IDs to be confirmed).
- AC4: Streaming responses are supported (tokens appear as they arrive).
- AC5: Tool calls / function calling works via OpenRouter's OpenAI-compatible API.
- AC6: Graceful error handling for rate limits, auth errors, network failures.

### F3: Tool System

The AI can use tools to interact with the user's codebase and system.

**Tools required for v1:**

| Tool | Description |
|------|-------------|
| `read_file` | Read contents of a file |
| `write_file` | Create or overwrite a file |
| `edit_file` | Replace a specific string in a file |
| `shell_exec` | Execute a shell command |
| `glob` | Find files matching a pattern |
| `grep` | Search file contents with regex |

**Acceptance Criteria:**
- AC1: AI can call tools via function calling in the OpenRouter API.
- AC2: Each tool has a JSON schema definition sent to the model.
- AC3: Tool results are returned to the model as follow-up messages.
- AC4: Multi-step tool use works (AI calls tool, gets result, calls another tool, etc.).
- AC5: Tool execution is logged to the terminal so the user sees what's happening.

### F4: Permission System

Users must approve potentially dangerous actions before they execute.

**Acceptance Criteria:**
- AC1: `shell_exec` always asks for user approval before running (shows the command).
- AC2: `write_file` and `edit_file` show a diff/preview and ask for approval.
- AC3: `read_file`, `glob`, and `grep` run automatically (read-only, safe).
- AC4: User can approve with `y`, deny with `n`.
- AC5: Denied actions return a "permission denied" result to the model so it can adjust.

### F5: Persistent Memory

The AI remembers context across sessions via markdown files.

**Acceptance Criteria:**
- AC1: Memory is stored in `.stormtrooper/memory/` in the project directory.
- AC2: A `MEMORY.md` file is loaded into the system prompt at the start of each session.
- AC3: The AI can write to memory files using a `memory_write` tool.
- AC4: Memory files persist across sessions (they're just files on disk).
- AC5: The user can manually edit memory files.

### F6: Project Context

The AI understands the project it's working in.

**Acceptance Criteria:**
- AC1: Stormtrooper reads a `STORMTROOPER.md` (or `CLAUDE.md` for compat) file from the project root and includes it in the system prompt.
- AC2: The AI knows the current working directory.
- AC3: The AI can explore the project using `glob` and `grep` tools.

### F7: Agent Teams

The user or AI can spawn sub-agents to work on tasks in parallel.

**Acceptance Criteria:**
- AC1: A `spawn_agent` tool allows the AI to create a sub-agent with a specific task.
- AC2: Sub-agents run concurrently and have access to the same tools.
- AC3: Sub-agent results are returned to the parent agent.
- AC4: The user sees sub-agent activity in the terminal (which agent is doing what).
- AC5: Sub-agents can use a different model than the parent if specified.

### F8: Configuration

User preferences are stored in config files.

**Acceptance Criteria:**
- AC1: Global config at `~/.stormtrooper/config.yaml`.
- AC2: Project config at `.stormtrooper/config.yaml` (overrides global).
- AC3: Configurable: default model, API key (fallback), permission mode, memory settings.
- AC4: CLI flags override config file values.

## Non-Goals for v0.1.0

- TUI (rich terminal UI with panels) — conversational CLI only.
- Commercial model support (OpenAI, Anthropic) — later.
- Plugin/extension system.
- Remote/cloud sync of memory.
- IDE integrations.
- Homebrew/package manager distribution.

## Architecture Guidance

- Use Go modules. Keep dependencies minimal.
- Structure: `cmd/` for CLI entry point, `internal/` for packages.
- Use the OpenAI-compatible chat completions API (OpenRouter is compatible).
- Streaming via SSE (Server-Sent Events) for token-by-token output.
- Tools use the standard OpenAI function calling format.
- Agent teams are goroutines with their own conversation context.
